define(['angular','angular-mocks', 'scenarioCtrl','features','treeLayoutService'], function(angular,angularMocks, scenarioCtrl,features,treeLayoutService) {
    'use strict';
    describe('ScenarioCtrl', function() {
        console.log("---- Starting : socket ScenarioCtrl test ----");
        var $controller,
        scope,
        clientService,
        UtilsScenarioService,
        ws,
        injectedWs;
    
        var scenario = {
            "_id" : "56faad9a3584d35303f8da34",
            "name" : "rgr",
            "type" : "web",
            "driver" : "web",
            "rows" : [],
            "parent" : "56faad383584d32d03f8da30"
        };

            var typeDescriptor = [
            {"id":"1","name":"Value","kind":"string","category":"value","regex":"\\*([\\$?\\w\\W]+)\\*","replacement":"@[[1:value:string]]"},
            {"id":"3","name":"Service","kind":"service","category":"component","regex":"","replacement":"@[[3:component:service]]"},
            {"id":"4","name":"WebPageItem","kind":"web","category":"component","regex":"\\*(\\w+).(\\w+)\\*","replacement":"@[[4:component:web]]"},
            {"id":"5","name":"EntityItem","kind":"entity","category":"component","regex":"","replacement":"@[[5:component:entity]]"},
            {"id":"6","name":"SwiBonngComponent","kind":"swing","category":"component","regex":"\\*(\\w+).(\\w+)\\*","replacement":"@[[6:component:swing]]"}
        ];

/*        var typeDescriptor = [
            {"id":"1","name":"Value","kind":"string","category":"value","regex":"\\*([\\$?\\w\\W]+)\\*","replacement":"@[[1:value:string]]"},
            {"id":"3","name":"Service","kind":"service","category":"component","regex":"","replacement":"@[[3:component:service]]"},
            {"id":"4","name":"WebPageItem","kind":"web","category":"component","regex":"\\*(\\w+).(\\w+)\\*","replacement":"@[[4:component:web]]"},
            {"id":"5","name":"EntityItem","kind":"entity","category":"component","regex":"","replacement":"@[[5:component:entity]]"},
            {"id":"6","name":"SwiBonngComponent","kind":"swing","category":"component","regex":"\\*(\\w+).(\\w+)\\*","replacement":"@[[6:component:swing]]"}
        ];>*/

            var CtxSentences = {
            swing: [{"id":"56deaf95ee04d945de74d08d","type":"default","rows":[{"type":"web","name":"AbstractWebActionAdapter","syntax":[{"sentence":"Select the {{value:string}}th {{value:string}} as {{value:string}}","typed_sentence":"Select the {{value:string}}th {{value:string}} as {{value:string}}","description":""},{"sentence":"Select the {{value:string}}th {{component:web}} as {{value:string}}","typed_sentence":"Select the {{value:string}}th {{component:web}} as {{value:string}}","description":""},{"sentence":"With {{component:web}} as {{value:string}}","typed_sentence":"With {{component:web}} as {{value:string}}","description":""},{"sentence":"Close browser","typed_sentence":"Close browser","description":""},{"sentence":"Click on {{component:web}}","typed_sentence":"Click on {{component:web}}","description":""},{"sentence":"Click on {{value:string}}","typed_sentence":"Click on {{value:string}}","description":""},{"sentence":"Select {{value:string}} in {{value:string}}","typed_sentence":"Select {{value:string}} in {{value:string}}","description":""},{"sentence":"Select {{value:string}} in {{component:web}}","typed_sentence":"Select {{value:string}} in {{component:web}}","description":""},{"sentence":"Type {{value:string}} in {{component:web}}","typed_sentence":"Type {{value:string}} in {{component:web}}","description":""},{"sentence":"Open browser at {{value:string}}","typed_sentence":"Open browser at {{value:string}}","description":""},{"sentence":"Read {{component:web}}","typed_sentence":"Read {{component:web}}","description":""},{"sentence":"Read {{value:string}}","typed_sentence":"Read {{value:string}}","description":""},{"sentence":"{{value:string}} exists","typed_sentence":"{{value:string}} exists","description":""},{"sentence":"{{component:web}} exists","typed_sentence":"{{component:web}} exists","description":""},{"sentence":"Count {{value:string}}","typed_sentence":"Count {{value:string}}","description":""},{"sentence":"Count {{component:web}}","typed_sentence":"Count {{component:web}}","description":""}]},{"type":"swing","name":"AbstractSwingActionAdapter","syntax":[{"sentence":"Récupérer la valeur de {{component:swing}}","typed_sentence":"Récupérer la valeur de {{component:swing}}","description":"Lire la valeur d'un composant graphique"},{"sentence":"Click on {{component:swing}} in {{component:swing}}","typed_sentence":"Click on {{component:swing}} in {{component:swing}}","description":"Cliquer sur un composant présent dans un contenant de composant"},{"sentence":"Selectionner le menu contextuel {{value:string}}","typed_sentence":"Selectionner le menu contextuel {{value:string}}","description":"selectionner un menu dans une popup contextuelle"},{"sentence":"{{component:swing}} is active","typed_sentence":"{{component:swing}} is active","description":"Verifie si un composant est actif"},{"sentence":"Click on {{component:swing}}","typed_sentence":"Click on {{component:swing}}","description":"Cliquer sur un composant graphique"},{"sentence":"Selectionner menu {{value:string}}","typed_sentence":"Selectionner menu {{value:string}}","description":"Selectionner un menu, avec / comme séparateur"},{"sentence":"Selectionner {{value:string}} dans {{component:swing}}","typed_sentence":"Selectionner {{value:string}} dans {{component:swing}}","description":"Selectionner une valeur dans une liste"},{"sentence":"wait for {{value:string}} sec","typed_sentence":"wait for {{value:string}} sec","description":"Attendre n secondes avant la prochaine action"},{"sentence":"Selection menu {{component:swing}} dans {{component:swing}}","typed_sentence":"Selection menu {{component:swing}} dans {{component:swing}}","description":"Selectionner un sous menu"},{"sentence":"Type {{value:string}} in {{component:swing}}","typed_sentence":"Type {{value:string}} in {{component:swing}}","description":"Saisir la valeur d'une variable dans un champs graphique de type input"},{"sentence":"Ajuster date (\\w+).(\\w+) à plus (\\w+) jours","typed_sentence":"Ajuster date (\\w+).(\\w+) à plus (\\w+) jours","description":"Rajouter n Jours à au composant graphique de date"},{"sentence":"{{component:swing}} exists","typed_sentence":"{{component:swing}} exists","description":"Verifier qu'un composant graphique existe"},{"sentence":"Saisir {{value:string}}","typed_sentence":"Saisir {{value:string}}","description":"Saisir une chaine de caractère au clavier"},{"sentence":"Affichage dialogue {{value:string}}","typed_sentence":"Affichage dialogue {{value:string}}","description":"Afichage d'une dialogue"},{"sentence":"Type {{value:string}} in {{component:swing}}","typed_sentence":"Type {{value:string}} in {{component:swing}}","description":"Saisir une valeur dans un composant graphique"},{"sentence":"Récupérer la valeur de {{component:swing}} dans {{value:string}}","typed_sentence":"Récupérer la valeur de {{component:swing}} dans {{value:string}}","description":"Lire la valeur d'un composant graphique et la stocker dans une variable"},{"sentence":"Dans {{component:swing}} selectionner la ligne ayant {{value:string}}","typed_sentence":"Dans {{component:swing}} selectionner la ligne ayant {{value:string}}","description":"Selectionner une ligne de tableau avec critères"},{"sentence":"Clear {{input:component:swing}}","typed_sentence":"Clear {{input:component:swing}}","description":"Effacer le contenu d'un composant input graphique"},{"sentence":"Count {{component:swing}} results","typed_sentence":"Count {{component:swing}} results","description":"Compter le nombre de ligne dans un tableau"}]},{"type":"service","name":"AbstractCommonActionAdapter","syntax":[{"sentence":"{{value:string}} égale à {{value:string}}","typed_sentence":"{{value:string}} égale à {{value:string}}","description":"Comparer une valeur à une variable"},{"sentence":"Ajouter {{value:string}} à {{value:string}}","typed_sentence":"Ajouter {{value:string}} à {{value:string}}","description":"Additionner deux valeurs numériques"},{"sentence":"Assigner {{value:string}} à {{value:string}}","typed_sentence":"Assigner {{value:string}} à {{value:string}}","description":"Assigner valeur à variable"},{"sentence":"Retrancher {{value:string}} à {{value:string}}","typed_sentence":"Retrancher {{value:string}} à {{value:string}}","description":"Soustraire deux valeurs numériques"},{"sentence":"{{value:string}} == {{value:string}}","typed_sentence":"{{value:string}} == {{value:string}}","description":"Comparer deux variables"},{"sentence":"Diviser {{value:string}} par {{value:string}}","typed_sentence":"Diviser {{value:string}} par {{value:string}}","description":"Diviseur le premier argument par le deuxième"},{"sentence":"Enregister {{value:string}} dans {{value:string}}","typed_sentence":"Enregister {{value:string}} dans {{value:string}}","description":"Assigner une valeur à une variable"},{"sentence":"Multiplier {{value:string}} par {{value:string}}","typed_sentence":"Multiplier {{value:string}} par {{value:string}}","description":"Multiplier deux valeurs"}]}]},{"id":"5534c3532000003100ce84b8","type":"RUSProdTNR","rows":[{"type":"web","name":"rus-web-connector","syntax":[{"sentence":"Le train {{value:string}} est affiché sur la carte {{value:string}}","typed_sentence":"Le train {{value:string}} est affiché sur la carte {{value:string}}","description":""}]},{"type":"swing","name":"RUSAssemblageConnector","syntax":[{"sentence":"Saisir {{value:string}}","typed_sentence":"Saisir {{value:string}}","description":"Saisir une chaine de caractère au clavier"},{"sentence":"{{component:swing}} is active","typed_sentence":"{{component:swing}} is active","description":"Verifie si un composant est actif"},{"sentence":"Ouvrir le menu sur {{value:string}} pour le flux {{value:string}} au {{value:string}}","typed_sentence":"Ouvrir le menu sur {{value:string}} pour le flux {{value:string}} au {{value:string}}","description":""},{"sentence":"Type {{value:string}} in {{component:swing}}","typed_sentence":"Type {{value:string}} in {{component:swing}}","description":"Saisir la valeur d'une variable dans un champs graphique de type input"},{"sentence":"Saisir {{value:string}} dans {{value:string}} pour le flux {{value:string}} au {{value:string}}","typed_sentence":"Saisir {{value:string}} dans {{value:string}} pour le flux {{value:string}} au {{value:string}}","description":""},{"sentence":"Selectionner le menu contextuel {{value:string}}","typed_sentence":"Selectionner le menu contextuel {{value:string}}","description":"selectionner un menu dans une popup contextuelle"},{"sentence":"Clear {{input:component:swing}}","typed_sentence":"Clear {{input:component:swing}}","description":"Effacer le contenu d'un composant input graphique"},{"sentence":"Stocker dans {{value:string}} la valeur du flux {{value:string}} dans {{value:string}} au {{value:string}}","typed_sentence":"Stocker dans {{value:string}} la valeur du flux {{value:string}} dans {{value:string}} au {{value:string}}","description":""},{"sentence":"Récupérer la valeur de {{component:swing}}","typed_sentence":"Récupérer la valeur de {{component:swing}}","description":"Lire la valeur d'un composant graphique"},{"sentence":"Type {{value:string}} in {{component:swing}}","typed_sentence":"Type {{value:string}} in {{component:swing}}","description":"Saisir une valeur dans un composant graphique"},{"sentence":"Affichage dialogue {{value:string}}","typed_sentence":"Affichage dialogue {{value:string}}","description":"Afichage d'une dialogue"},{"sentence":"Click on {{component:swing}} in {{component:swing}}","typed_sentence":"Click on {{component:swing}} in {{component:swing}}","description":"Cliquer sur un composant présent dans un contenant de composant"},{"sentence":"Selection menu {{component:swing}} dans {{component:swing}}","typed_sentence":"Selection menu {{component:swing}} dans {{component:swing}}","description":"Selectionner un sous menu"},{"sentence":"wait for {{value:string}} sec","typed_sentence":"wait for {{value:string}} sec","description":"Attendre n secondes avant la prochaine action"},{"sentence":"{{component:swing}} exists","typed_sentence":"{{component:swing}} exists","description":"Verifier qu'un composant graphique existe"},{"sentence":"Ajuster date (\\w+).(\\w+) à plus (\\w+) jours","typed_sentence":"Ajuster date (\\w+).(\\w+) à plus (\\w+) jours","description":"Rajouter n Jours à au composant graphique de date"},{"sentence":"Selectionner {{value:string}} dans {{component:swing}}","typed_sentence":"Selectionner {{value:string}} dans {{component:swing}}","description":"Selectionner une valeur dans une liste"},{"sentence":"Count {{component:swing}} results","typed_sentence":"Count {{component:swing}} results","description":"Compter le nombre de ligne dans un tableau"},{"sentence":"Dans {{component:swing}} selectionner la ligne ayant {{value:string}}","typed_sentence":"Dans {{component:swing}} selectionner la ligne ayant {{value:string}}","description":"Selectionner une ligne de tableau avec critères"},{"sentence":"Selectionner menu {{value:string}}","typed_sentence":"Selectionner menu {{value:string}}","description":"Selectionner un menu, avec / comme séparateur"},{"sentence":"Cliquer sur {{value:string}} pour le flux {{value:string}} au {{value:string}}","typed_sentence":"Cliquer sur {{value:string}} pour le flux {{value:string}} au {{value:string}}","description":""},{"sentence":"Click on {{component:swing}}","typed_sentence":"Click on {{component:swing}}","description":"Cliquer sur un composant graphique"},{"sentence":"Récupérer la valeur de {{component:swing}} dans {{value:string}}","typed_sentence":"Récupérer la valeur de {{component:swing}} dans {{value:string}}","description":"Lire la valeur d'un composant graphique et la stocker dans une variable"}]},{"type":"service","name":"RUSServerConnector","syntax":[{"sentence":"ExecuteSQLQuery {{value:string}} TO {{value:string}}","typed_sentence":"ExecuteSQLQuery {{value:string}} TO {{value:string}}","description":"appels SQL"},{"sentence":"swi-normal/assemblage.prevision/findOnePrevisionForTnr {{value:string}} AS {{value:string}}","typed_sentence":"swi-normal/assemblage.prevision/findOnePrevisionForTnr {{value:string}} AS {{value:string}}","description":""},{"sentence":"ExecuteService {{value:string}} IN {{value:string}} FOR {{value:string}}","typed_sentence":"ExecuteService {{value:string}} IN {{value:string}} FOR {{value:string}}","description":"appels service"},{"sentence":"swi-normal/assemblage.prevision/findEstActifPrevisionForTnr {{value:string}} (\\$\\w+) {{value:string}} IN {{value:string}}","typed_sentence":"swi-normal/assemblage.prevision/findEstActifPrevisionForTnr {{value:string}} (\\$\\w+) {{value:string}} IN {{value:string}}","description":""}]}]}],
            service : [{"id":"56deaf95ee04d945de74d08d","type":"default","rows":[{"type":"web","name":"AbstractWebActionAdapter","syntax":[{"sentence":"Select the {{value:string}}th {{value:string}} as {{value:string}}","typed_sentence":"Select the {{value:string}}th {{value:string}} as {{value:string}}","description":""},{"sentence":"Select the {{value:string}}th {{component:web}} as {{value:string}}","typed_sentence":"Select the {{value:string}}th {{component:web}} as {{value:string}}","description":""},{"sentence":"With {{component:web}} as {{value:string}}","typed_sentence":"With {{component:web}} as {{value:string}}","description":""},{"sentence":"Close browser","typed_sentence":"Close browser","description":""},{"sentence":"Click on {{component:web}}","typed_sentence":"Click on {{component:web}}","description":""},{"sentence":"Click on {{value:string}}","typed_sentence":"Click on {{value:string}}","description":""},{"sentence":"Select {{value:string}} in {{value:string}}","typed_sentence":"Select {{value:string}} in {{value:string}}","description":""},{"sentence":"Select {{value:string}} in {{component:web}}","typed_sentence":"Select {{value:string}} in {{component:web}}","description":""},{"sentence":"Type {{value:string}} in {{component:web}}","typed_sentence":"Type {{value:string}} in {{component:web}}","description":""},{"sentence":"Open browser at {{value:string}}","typed_sentence":"Open browser at {{value:string}}","description":""},{"sentence":"Read {{component:web}}","typed_sentence":"Read {{component:web}}","description":""},{"sentence":"Read {{value:string}}","typed_sentence":"Read {{value:string}}","description":""},{"sentence":"{{value:string}} exists","typed_sentence":"{{value:string}} exists","description":""},{"sentence":"{{component:web}} exists","typed_sentence":"{{component:web}} exists","description":""},{"sentence":"Count {{value:string}}","typed_sentence":"Count {{value:string}}","description":""},{"sentence":"Count {{component:web}}","typed_sentence":"Count {{component:web}}","description":""}]},{"type":"swing","name":"AbstractSwingActionAdapter","syntax":[{"sentence":"Récupérer la valeur de {{component:swing}}","typed_sentence":"Récupérer la valeur de {{component:swing}}","description":"Lire la valeur d'un composant graphique"},{"sentence":"Click on {{component:swing}} in {{component:swing}}","typed_sentence":"Click on {{component:swing}} in {{component:swing}}","description":"Cliquer sur un composant présent dans un contenant de composant"},{"sentence":"Selectionner le menu contextuel {{value:string}}","typed_sentence":"Selectionner le menu contextuel {{value:string}}","description":"selectionner un menu dans une popup contextuelle"},{"sentence":"{{component:swing}} is active","typed_sentence":"{{component:swing}} is active","description":"Verifie si un composant est actif"},{"sentence":"Click on {{component:swing}}","typed_sentence":"Click on {{component:swing}}","description":"Cliquer sur un composant graphique"},{"sentence":"Selectionner menu {{value:string}}","typed_sentence":"Selectionner menu {{value:string}}","description":"Selectionner un menu, avec / comme séparateur"},{"sentence":"Selectionner {{value:string}} dans {{component:swing}}","typed_sentence":"Selectionner {{value:string}} dans {{component:swing}}","description":"Selectionner une valeur dans une liste"},{"sentence":"wait for {{value:string}} sec","typed_sentence":"wait for {{value:string}} sec","description":"Attendre n secondes avant la prochaine action"},{"sentence":"Selection menu {{component:swing}} dans {{component:swing}}","typed_sentence":"Selection menu {{component:swing}} dans {{component:swing}}","description":"Selectionner un sous menu"},{"sentence":"Type {{value:string}} in {{component:swing}}","typed_sentence":"Type {{value:string}} in {{component:swing}}","description":"Saisir la valeur d'une variable dans un champs graphique de type input"},{"sentence":"Ajuster date (\\w+).(\\w+) à plus (\\w+) jours","typed_sentence":"Ajuster date (\\w+).(\\w+) à plus (\\w+) jours","description":"Rajouter n Jours à au composant graphique de date"},{"sentence":"{{component:swing}} exists","typed_sentence":"{{component:swing}} exists","description":"Verifier qu'un composant graphique existe"},{"sentence":"Saisir {{value:string}}","typed_sentence":"Saisir {{value:string}}","description":"Saisir une chaine de caractère au clavier"},{"sentence":"Affichage dialogue {{value:string}}","typed_sentence":"Affichage dialogue {{value:string}}","description":"Afichage d'une dialogue"},{"sentence":"Type {{value:string}} in {{component:swing}}","typed_sentence":"Type {{value:string}} in {{component:swing}}","description":"Saisir une valeur dans un composant graphique"},{"sentence":"Récupérer la valeur de {{component:swing}} dans {{value:string}}","typed_sentence":"Récupérer la valeur de {{component:swing}} dans {{value:string}}","description":"Lire la valeur d'un composant graphique et la stocker dans une variable"},{"sentence":"Dans {{component:swing}} selectionner la ligne ayant {{value:string}}","typed_sentence":"Dans {{component:swing}} selectionner la ligne ayant {{value:string}}","description":"Selectionner une ligne de tableau avec critères"},{"sentence":"Clear {{input:component:swing}}","typed_sentence":"Clear {{input:component:swing}}","description":"Effacer le contenu d'un composant input graphique"},{"sentence":"Count {{component:swing}} results","typed_sentence":"Count {{component:swing}} results","description":"Compter le nombre de ligne dans un tableau"}]},{"type":"service","name":"AbstractCommonActionAdapter","syntax":[{"sentence":"{{value:string}} égale à {{value:string}}","typed_sentence":"{{value:string}} égale à {{value:string}}","description":"Comparer une valeur à une variable"},{"sentence":"Ajouter {{value:string}} à {{value:string}}","typed_sentence":"Ajouter {{value:string}} à {{value:string}}","description":"Additionner deux valeurs numériques"},{"sentence":"Assigner {{value:string}} à {{value:string}}","typed_sentence":"Assigner {{value:string}} à {{value:string}}","description":"Assigner valeur à variable"},{"sentence":"Retrancher {{value:string}} à {{value:string}}","typed_sentence":"Retrancher {{value:string}} à {{value:string}}","description":"Soustraire deux valeurs numériques"},{"sentence":"{{value:string}} == {{value:string}}","typed_sentence":"{{value:string}} == {{value:string}}","description":"Comparer deux variables"},{"sentence":"Diviser {{value:string}} par {{value:string}}","typed_sentence":"Diviser {{value:string}} par {{value:string}}","description":"Diviseur le premier argument par le deuxième"},{"sentence":"Enregister {{value:string}} dans {{value:string}}","typed_sentence":"Enregister {{value:string}} dans {{value:string}}","description":"Assigner une valeur à une variable"},{"sentence":"Multiplier {{value:string}} par {{value:string}}","typed_sentence":"Multiplier {{value:string}} par {{value:string}}","description":"Multiplier deux valeurs"}]}]},{"id":"5534c3532000003100ce84b8","type":"RUSProdTNR","rows":[{"type":"web","name":"rus-web-connector","syntax":[{"sentence":"Le train {{value:string}} est affiché sur la carte {{value:string}}","typed_sentence":"Le train {{value:string}} est affiché sur la carte {{value:string}}","description":""}]},{"type":"swing","name":"RUSAssemblageConnector","syntax":[{"sentence":"Saisir {{value:string}}","typed_sentence":"Saisir {{value:string}}","description":"Saisir une chaine de caractère au clavier"},{"sentence":"{{component:swing}} is active","typed_sentence":"{{component:swing}} is active","description":"Verifie si un composant est actif"},{"sentence":"Ouvrir le menu sur {{value:string}} pour le flux {{value:string}} au {{value:string}}","typed_sentence":"Ouvrir le menu sur {{value:string}} pour le flux {{value:string}} au {{value:string}}","description":""},{"sentence":"Type {{value:string}} in {{component:swing}}","typed_sentence":"Type {{value:string}} in {{component:swing}}","description":"Saisir la valeur d'une variable dans un champs graphique de type input"},{"sentence":"Saisir {{value:string}} dans {{value:string}} pour le flux {{value:string}} au {{value:string}}","typed_sentence":"Saisir {{value:string}} dans {{value:string}} pour le flux {{value:string}} au {{value:string}}","description":""},{"sentence":"Selectionner le menu contextuel {{value:string}}","typed_sentence":"Selectionner le menu contextuel {{value:string}}","description":"selectionner un menu dans une popup contextuelle"},{"sentence":"Clear {{input:component:swing}}","typed_sentence":"Clear {{input:component:swing}}","description":"Effacer le contenu d'un composant input graphique"},{"sentence":"Stocker dans {{value:string}} la valeur du flux {{value:string}} dans {{value:string}} au {{value:string}}","typed_sentence":"Stocker dans {{value:string}} la valeur du flux {{value:string}} dans {{value:string}} au {{value:string}}","description":""},{"sentence":"Récupérer la valeur de {{component:swing}}","typed_sentence":"Récupérer la valeur de {{component:swing}}","description":"Lire la valeur d'un composant graphique"},{"sentence":"Type {{value:string}} in {{component:swing}}","typed_sentence":"Type {{value:string}} in {{component:swing}}","description":"Saisir une valeur dans un composant graphique"},{"sentence":"Affichage dialogue {{value:string}}","typed_sentence":"Affichage dialogue {{value:string}}","description":"Afichage d'une dialogue"},{"sentence":"Click on {{component:swing}} in {{component:swing}}","typed_sentence":"Click on {{component:swing}} in {{component:swing}}","description":"Cliquer sur un composant présent dans un contenant de composant"},{"sentence":"Selection menu {{component:swing}} dans {{component:swing}}","typed_sentence":"Selection menu {{component:swing}} dans {{component:swing}}","description":"Selectionner un sous menu"},{"sentence":"wait for {{value:string}} sec","typed_sentence":"wait for {{value:string}} sec","description":"Attendre n secondes avant la prochaine action"},{"sentence":"{{component:swing}} exists","typed_sentence":"{{component:swing}} exists","description":"Verifier qu'un composant graphique existe"},{"sentence":"Ajuster date (\\w+).(\\w+) à plus (\\w+) jours","typed_sentence":"Ajuster date (\\w+).(\\w+) à plus (\\w+) jours","description":"Rajouter n Jours à au composant graphique de date"},{"sentence":"Selectionner {{value:string}} dans {{component:swing}}","typed_sentence":"Selectionner {{value:string}} dans {{component:swing}}","description":"Selectionner une valeur dans une liste"},{"sentence":"Count {{component:swing}} results","typed_sentence":"Count {{component:swing}} results","description":"Compter le nombre de ligne dans un tableau"},{"sentence":"Dans {{component:swing}} selectionner la ligne ayant {{value:string}}","typed_sentence":"Dans {{component:swing}} selectionner la ligne ayant {{value:string}}","description":"Selectionner une ligne de tableau avec critères"},{"sentence":"Selectionner menu {{value:string}}","typed_sentence":"Selectionner menu {{value:string}}","description":"Selectionner un menu, avec / comme séparateur"},{"sentence":"Cliquer sur {{value:string}} pour le flux {{value:string}} au {{value:string}}","typed_sentence":"Cliquer sur {{value:string}} pour le flux {{value:string}} au {{value:string}}","description":""},{"sentence":"Click on {{component:swing}}","typed_sentence":"Click on {{component:swing}}","description":"Cliquer sur un composant graphique"},{"sentence":"Récupérer la valeur de {{component:swing}} dans {{value:string}}","typed_sentence":"Récupérer la valeur de {{component:swing}} dans {{value:string}}","description":"Lire la valeur d'un composant graphique et la stocker dans une variable"}]},{"type":"service","name":"RUSServerConnector","syntax":[{"sentence":"ExecuteSQLQuery {{value:string}} TO {{value:string}}","typed_sentence":"ExecuteSQLQuery {{value:string}} TO {{value:string}}","description":"appels SQL"},{"sentence":"swi-normal/assemblage.prevision/findOnePrevisionForTnr {{value:string}} AS {{value:string}}","typed_sentence":"swi-normal/assemblage.prevision/findOnePrevisionForTnr {{value:string}} AS {{value:string}}","description":""},{"sentence":"ExecuteService {{value:string}} IN {{value:string}} FOR {{value:string}}","typed_sentence":"ExecuteService {{value:string}} IN {{value:string}} FOR {{value:string}}","description":"appels service"},{"sentence":"swi-normal/assemblage.prevision/findEstActifPrevisionForTnr {{value:string}} (\\$\\w+) {{value:string}} IN {{value:string}}","typed_sentence":"swi-normal/assemblage.prevision/findEstActifPrevisionForTnr {{value:string}} (\\$\\w+) {{value:string}} IN {{value:string}}","description":""}]}]}],
            web : [{"id":"56deaf95ee04d945de74d08d","type":"default","rows":[{"type":"web","name":"AbstractWebActionAdapter","syntax":[{"sentence":"Select the {{value:string}}th {{value:string}} as {{value:string}}","typed_sentence":"Select the {{value:string}}th {{value:string}} as {{value:string}}","description":""},{"sentence":"Select the {{value:string}}th {{component:web}} as {{value:string}}","typed_sentence":"Select the {{value:string}}th {{component:web}} as {{value:string}}","description":""},{"sentence":"With {{component:web}} as {{value:string}}","typed_sentence":"With {{component:web}} as {{value:string}}","description":""},{"sentence":"Close browser","typed_sentence":"Close browser","description":""},{"sentence":"Click on {{component:web}}","typed_sentence":"Click on {{component:web}}","description":""},{"sentence":"Click on {{value:string}}","typed_sentence":"Click on {{value:string}}","description":""},{"sentence":"Select {{value:string}} in {{value:string}}","typed_sentence":"Select {{value:string}} in {{value:string}}","description":""},{"sentence":"Select {{value:string}} in {{component:web}}","typed_sentence":"Select {{value:string}} in {{component:web}}","description":""},{"sentence":"Type {{value:string}} in {{component:web}}","typed_sentence":"Type {{value:string}} in {{component:web}}","description":""},{"sentence":"Open browser at {{value:string}}","typed_sentence":"Open browser at {{value:string}}","description":""},{"sentence":"Read {{component:web}}","typed_sentence":"Read {{component:web}}","description":""},{"sentence":"Read {{value:string}}","typed_sentence":"Read {{value:string}}","description":""},{"sentence":"{{value:string}} exists","typed_sentence":"{{value:string}} exists","description":""},{"sentence":"{{component:web}} exists","typed_sentence":"{{component:web}} exists","description":""},{"sentence":"Count {{value:string}}","typed_sentence":"Count {{value:string}}","description":""},{"sentence":"Count {{component:web}}","typed_sentence":"Count {{component:web}}","description":""}]},{"type":"swing","name":"AbstractSwingActionAdapter","syntax":[{"sentence":"Récupérer la valeur de {{component:swing}}","typed_sentence":"Récupérer la valeur de {{component:swing}}","description":"Lire la valeur d'un composant graphique"},{"sentence":"Click on {{component:swing}} in {{component:swing}}","typed_sentence":"Click on {{component:swing}} in {{component:swing}}","description":"Cliquer sur un composant présent dans un contenant de composant"},{"sentence":"Selectionner le menu contextuel {{value:string}}","typed_sentence":"Selectionner le menu contextuel {{value:string}}","description":"selectionner un menu dans une popup contextuelle"},{"sentence":"{{component:swing}} is active","typed_sentence":"{{component:swing}} is active","description":"Verifie si un composant est actif"},{"sentence":"Click on {{component:swing}}","typed_sentence":"Click on {{component:swing}}","description":"Cliquer sur un composant graphique"},{"sentence":"Selectionner menu {{value:string}}","typed_sentence":"Selectionner menu {{value:string}}","description":"Selectionner un menu, avec / comme séparateur"},{"sentence":"Selectionner {{value:string}} dans {{component:swing}}","typed_sentence":"Selectionner {{value:string}} dans {{component:swing}}","description":"Selectionner une valeur dans une liste"},{"sentence":"wait for {{value:string}} sec","typed_sentence":"wait for {{value:string}} sec","description":"Attendre n secondes avant la prochaine action"},{"sentence":"Selection menu {{component:swing}} dans {{component:swing}}","typed_sentence":"Selection menu {{component:swing}} dans {{component:swing}}","description":"Selectionner un sous menu"},{"sentence":"Type {{value:string}} in {{component:swing}}","typed_sentence":"Type {{value:string}} in {{component:swing}}","description":"Saisir la valeur d'une variable dans un champs graphique de type input"},{"sentence":"Ajuster date (\\w+).(\\w+) à plus (\\w+) jours","typed_sentence":"Ajuster date (\\w+).(\\w+) à plus (\\w+) jours","description":"Rajouter n Jours à au composant graphique de date"},{"sentence":"{{component:swing}} exists","typed_sentence":"{{component:swing}} exists","description":"Verifier qu'un composant graphique existe"},{"sentence":"Saisir {{value:string}}","typed_sentence":"Saisir {{value:string}}","description":"Saisir une chaine de caractère au clavier"},{"sentence":"Affichage dialogue {{value:string}}","typed_sentence":"Affichage dialogue {{value:string}}","description":"Afichage d'une dialogue"},{"sentence":"Type {{value:string}} in {{component:swing}}","typed_sentence":"Type {{value:string}} in {{component:swing}}","description":"Saisir une valeur dans un composant graphique"},{"sentence":"Récupérer la valeur de {{component:swing}} dans {{value:string}}","typed_sentence":"Récupérer la valeur de {{component:swing}} dans {{value:string}}","description":"Lire la valeur d'un composant graphique et la stocker dans une variable"},{"sentence":"Dans {{component:swing}} selectionner la ligne ayant {{value:string}}","typed_sentence":"Dans {{component:swing}} selectionner la ligne ayant {{value:string}}","description":"Selectionner une ligne de tableau avec critères"},{"sentence":"Clear {{input:component:swing}}","typed_sentence":"Clear {{input:component:swing}}","description":"Effacer le contenu d'un composant input graphique"},{"sentence":"Count {{component:swing}} results","typed_sentence":"Count {{component:swing}} results","description":"Compter le nombre de ligne dans un tableau"}]},{"type":"service","name":"AbstractCommonActionAdapter","syntax":[{"sentence":"{{value:string}} égale à {{value:string}}","typed_sentence":"{{value:string}} égale à {{value:string}}","description":"Comparer une valeur à une variable"},{"sentence":"Ajouter {{value:string}} à {{value:string}}","typed_sentence":"Ajouter {{value:string}} à {{value:string}}","description":"Additionner deux valeurs numériques"},{"sentence":"Assigner {{value:string}} à {{value:string}}","typed_sentence":"Assigner {{value:string}} à {{value:string}}","description":"Assigner valeur à variable"},{"sentence":"Retrancher {{value:string}} à {{value:string}}","typed_sentence":"Retrancher {{value:string}} à {{value:string}}","description":"Soustraire deux valeurs numériques"},{"sentence":"{{value:string}} == {{value:string}}","typed_sentence":"{{value:string}} == {{value:string}}","description":"Comparer deux variables"},{"sentence":"Diviser {{value:string}} par {{value:string}}","typed_sentence":"Diviser {{value:string}} par {{value:string}}","description":"Diviseur le premier argument par le deuxième"},{"sentence":"Enregister {{value:string}} dans {{value:string}}","typed_sentence":"Enregister {{value:string}} dans {{value:string}}","description":"Assigner une valeur à une variable"},{"sentence":"Multiplier {{value:string}} par {{value:string}}","typed_sentence":"Multiplier {{value:string}} par {{value:string}}","description":"Multiplier deux valeurs"}]}]},{"id":"5534c3532000003100ce84b8","type":"RUSProdTNR","rows":[{"type":"web","name":"rus-web-connector","syntax":[{"sentence":"Le train {{value:string}} est affiché sur la carte {{value:string}}","typed_sentence":"Le train {{value:string}} est affiché sur la carte {{value:string}}","description":""}]},{"type":"swing","name":"RUSAssemblageConnector","syntax":[{"sentence":"Saisir {{value:string}}","typed_sentence":"Saisir {{value:string}}","description":"Saisir une chaine de caractère au clavier"},{"sentence":"{{component:swing}} is active","typed_sentence":"{{component:swing}} is active","description":"Verifie si un composant est actif"},{"sentence":"Ouvrir le menu sur {{value:string}} pour le flux {{value:string}} au {{value:string}}","typed_sentence":"Ouvrir le menu sur {{value:string}} pour le flux {{value:string}} au {{value:string}}","description":""},{"sentence":"Type {{value:string}} in {{component:swing}}","typed_sentence":"Type {{value:string}} in {{component:swing}}","description":"Saisir la valeur d'une variable dans un champs graphique de type input"},{"sentence":"Saisir {{value:string}} dans {{value:string}} pour le flux {{value:string}} au {{value:string}}","typed_sentence":"Saisir {{value:string}} dans {{value:string}} pour le flux {{value:string}} au {{value:string}}","description":""},{"sentence":"Selectionner le menu contextuel {{value:string}}","typed_sentence":"Selectionner le menu contextuel {{value:string}}","description":"selectionner un menu dans une popup contextuelle"},{"sentence":"Clear {{input:component:swing}}","typed_sentence":"Clear {{input:component:swing}}","description":"Effacer le contenu d'un composant input graphique"},{"sentence":"Stocker dans {{value:string}} la valeur du flux {{value:string}} dans {{value:string}} au {{value:string}}","typed_sentence":"Stocker dans {{value:string}} la valeur du flux {{value:string}} dans {{value:string}} au {{value:string}}","description":""},{"sentence":"Récupérer la valeur de {{component:swing}}","typed_sentence":"Récupérer la valeur de {{component:swing}}","description":"Lire la valeur d'un composant graphique"},{"sentence":"Type {{value:string}} in {{component:swing}}","typed_sentence":"Type {{value:string}} in {{component:swing}}","description":"Saisir une valeur dans un composant graphique"},{"sentence":"Affichage dialogue {{value:string}}","typed_sentence":"Affichage dialogue {{value:string}}","description":"Afichage d'une dialogue"},{"sentence":"Click on {{component:swing}} in {{component:swing}}","typed_sentence":"Click on {{component:swing}} in {{component:swing}}","description":"Cliquer sur un composant présent dans un contenant de composant"},{"sentence":"Selection menu {{component:swing}} dans {{component:swing}}","typed_sentence":"Selection menu {{component:swing}} dans {{component:swing}}","description":"Selectionner un sous menu"},{"sentence":"wait for {{value:string}} sec","typed_sentence":"wait for {{value:string}} sec","description":"Attendre n secondes avant la prochaine action"},{"sentence":"{{component:swing}} exists","typed_sentence":"{{component:swing}} exists","description":"Verifier qu'un composant graphique existe"},{"sentence":"Ajuster date (\\w+).(\\w+) à plus (\\w+) jours","typed_sentence":"Ajuster date (\\w+).(\\w+) à plus (\\w+) jours","description":"Rajouter n Jours à au composant graphique de date"},{"sentence":"Selectionner {{value:string}} dans {{component:swing}}","typed_sentence":"Selectionner {{value:string}} dans {{component:swing}}","description":"Selectionner une valeur dans une liste"},{"sentence":"Count {{component:swing}} results","typed_sentence":"Count {{component:swing}} results","description":"Compter le nombre de ligne dans un tableau"},{"sentence":"Dans {{component:swing}} selectionner la ligne ayant {{value:string}}","typed_sentence":"Dans {{component:swing}} selectionner la ligne ayant {{value:string}}","description":"Selectionner une ligne de tableau avec critères"},{"sentence":"Selectionner menu {{value:string}}","typed_sentence":"Selectionner menu {{value:string}}","description":"Selectionner un menu, avec / comme séparateur"},{"sentence":"Cliquer sur {{value:string}} pour le flux {{value:string}} au {{value:string}}","typed_sentence":"Cliquer sur {{value:string}} pour le flux {{value:string}} au {{value:string}}","description":""},{"sentence":"Click on {{component:swing}}","typed_sentence":"Click on {{component:swing}}","description":"Cliquer sur un composant graphique"},{"sentence":"Récupérer la valeur de {{component:swing}} dans {{value:string}}","typed_sentence":"Récupérer la valeur de {{component:swing}} dans {{value:string}}","description":"Lire la valeur d'un composant graphique et la stocker dans une variable"}]},{"type":"service","name":"RUSServerConnector","syntax":[{"sentence":"ExecuteSQLQuery {{value:string}} TO {{value:string}}","typed_sentence":"ExecuteSQLQuery {{value:string}} TO {{value:string}}","description":"appels SQL"},{"sentence":"swi-normal/assemblage.prevision/findOnePrevisionForTnr {{value:string}} AS {{value:string}}","typed_sentence":"swi-normal/assemblage.prevision/findOnePrevisionForTnr {{value:string}} AS {{value:string}}","description":""},{"sentence":"ExecuteService {{value:string}} IN {{value:string}} FOR {{value:string}}","typed_sentence":"ExecuteService {{value:string}} IN {{value:string}} FOR {{value:string}}","description":"appels service"},{"sentence":"swi-normal/assemblage.prevision/findEstActifPrevisionForTnr {{value:string}} (\\$\\w+) {{value:string}} IN {{value:string}}","typed_sentence":"swi-normal/assemblage.prevision/findEstActifPrevisionForTnr {{value:string}} (\\$\\w+) {{value:string}} IN {{value:string}}","description":""}]}]}]
        };


  function receiveMessage(message) {
    injectedWs.onmessage(message);
  };

        beforeEach(module('play.routing'));
        beforeEach(module('ui.bootstrap'));
        beforeEach(module('sidesplit'));
        beforeEach(module('app'));
        beforeEach(function(){
            module('tk.services', function ($provide) {
              injectedWs = {};    
              ws = function () {
                return injectedWs;
            };

            $provide.constant('webSocket', ws);
        });
            inject(function (_ClientService_,_UtilsScenarioService_) {
              clientService = _ClientService_;
              UtilsScenarioService = _UtilsScenarioService_;
          });
        });

        beforeEach(inject(function(_$controller_, $rootScope){
            $controller = _$controller_;
            scope = $rootScope.$new();
            $controller(scenarioCtrl.ScenarioCtrl, {$scope: scope});
        }));


        describe('Exact websocket sentence templatisation', function() {
            it("should call subscribers when a message is received", function () {
               // scope.scenario = scope.scenarii[0];
               function concatSentencesRow(connectorConfigGroups, scenariiKind){
                var list = [];
                   for(var j = 0; j< connectorConfigGroups.length; j++){
                    for (var k=0; k< connectorConfigGroups[j].rows.length; k++){
                        var connectorConfig = connectorConfigGroups[j].rows;
                        if(connectorConfig[k].type == scenariiKind){
                            list = list.concat( connectorConfig[k].syntax || []);
                        }
                    }
                }
                return list;
            }
               scope.scenario = scenario ;
               clientService.typeDescriptor = typeDescriptor || [];
               UtilsScenarioService.setRegexList("swing",concatSentencesRow(CtxSentences.swing,"swing"));
               UtilsScenarioService.setRegexList("web",concatSentencesRow(CtxSentences.web, "swing"));
               UtilsScenarioService.setRegexList("service",concatSentencesRow(CtxSentences.service, "swing"));
                scope.recordActions();

                var callback = jasmine.createSpy('onMessage callback');

                function message() {
                    return {
                        data: 'sentence: {"sentence":"Type *submit* in *LoginPage.login*", "ids":["570280c33584d34f0eabf93a"]}'
                    };
                }
                console.log("test messge", message().data);
                receiveMessage(message());
            });

        });
    });

});